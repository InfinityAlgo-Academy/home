// Products Database - Extracted from sitemap
const products = [
    {
        name: "Footprint Price Action Pro",
        category: ["ninjatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/footprint-price-action-pro-indicator-in-ninjatrader/",
        featured: true,
        date: "2026-01-08"
    },
    {
        name: "Nexus EA Forex MT5",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/nexus-ea-forex-mt5/",
        date: "2026-01-17"
    },
    {
        name: "Pivot Killer EA",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/pivot-killer-ea/",
        date: "2026-01-17"
    },
    {
        name: "Flip Bot EA - Ultimate Automated Trading Bot",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/flip-bot-ea-the-ultimate-automated-trading-bot-for-metatrader-5/",
        date: "2026-01-17"
    },
    {
        name: "80+ Pro TradingView Indicators Bundle",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/80-pro-tradingview-indicators-bundle-trade-smarter-with-one-powerful-system/",
        date: "2026-01-15"
    },
    {
        name: "Trend Lines Pro MT4",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/indicator-trend-lines-pro-mt4/",
        date: "2026-01-14"
    },
    {
        name: "Alpha Hunter System MTF Risk Manager",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/alpha-hunter-system-mtf-risk-manager-full-explanation/",
        date: "2026-01-14"
    },
    {
        name: "All-in-One Trading Course",
        category: ["course"],
        url: "https://infinityalgoacademy.net/item/all-in-one-course/",
        date: "2026-01-11"
    },
    {
        name: "AI Machine Learning Trading Bot - Mad Turtle",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/ai-machine-learning-trading-bot-mad-turtle/",
        date: "2026-01-10"
    },
    {
        name: "Volume MAS Oscillator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/volume-mas-oscillator-lyro-rs/",
        date: "2026-01-08"
    },
    {
        name: "Swing Failure Pattern LuxAlgo V2",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/swing-failure-pattern-luxalgo-v2-ex4/",
        date: "2026-01-08"
    },
    {
        name: "ATR Momentum Color MQL5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/atr-momentum-color-mql5/",
        date: "2026-01-08"
    },
    {
        name: "Lucky Reversal Indicator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/lucky-reversal-indicator/",
        date: "2026-01-08"
    },
    {
        name: "Buy Sell Magic Indicator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/buy-sell-magic-indicator/",
        date: "2026-01-08"
    },
    {
        name: "Taurus Binary RET Indicator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/taurus-binary-ret-indicator/",
        date: "2026-01-08"
    },
    {
        name: "Orion Gold Scalper EA V4.0",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/orion-gold-scalper-ea-v4-0-mt4/",
        date: "2026-01-08"
    },
    {
        name: "AI Gen XII EA V2.5",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/ai-gen-xii-ea-v2-5-mt4/",
        date: "2026-01-08"
    },
    {
        name: "Goldfinch EA for MetaTrader",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/free-goldfinch-ea-for-metatrader/",
        date: "2026-01-08"
    },
    {
        name: "Easy Trade Panel Expert MT5",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/easy-trade-panel-expert-for-metatrader-5-download-free/",
        date: "2026-01-08"
    },
    {
        name: "Corex G EA V1.6 MT4",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/corex-g-ea-v1-6-mt4-robot/",
        date: "2026-01-08"
    },
    {
        name: "Gold Trading AI EA MT4",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/gold-trading-ai-ea-mt4-robot-for-free/",
        date: "2026-01-08"
    },
    {
        name: "Dynamic Pips EA V2.2",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/free-download-dynamic-pips-ea-v2-2-mt4/",
        date: "2026-01-08"
    },
    {
        name: "Deep Scalper EA V5 Master",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/free-download-deep-scalper-ea-v5-master-mt4/",
        date: "2026-01-08"
    },
    {
        name: "Trading Session Time Indicator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/trading-session-time-indicator-for-mt4-mt5/",
        date: "2026-01-08"
    },
    {
        name: "Forex Liquidity and Market Sentiment Indicator",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/forex-liquidity-and-market-sentiment-indicator-mt4-mt5-free-download/",
        date: "2026-01-08"
    },
    {
        name: "FX Trade Detector EA",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/fx-trade-detector-ea-mt4-for-free-download/",
        date: "2026-01-08"
    },
    {
        name: "Advanced Hedge EA V4.0",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/advanced-hedge-ea-v4-0-mt4/",
        date: "2026-01-08"
    },
    {
        name: "Advanced Gold Trading V6.4 EA",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/advanced-gold-trading-v6-4-ea-mt4/",
        date: "2026-01-08"
    },
    {
        name: "Big Forex Players EA",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/big-forex-players-ea-mt4-free-download/",
        date: "2026-01-08"
    },
    {
        name: "The Gold Reaper EA V1.5",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/the-gold-reaper-ea-v1-5-mt4-free-download/",
        date: "2026-01-08"
    },
    {
        name: "AI Supertrend Clustering Oscillator MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/ai-supertrend-clustering-oscillator-for-mt5-download-free/",
        date: "2026-01-08"
    },
    {
        name: "ACD Indicator for MetaTrader 5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/acd-indicator-for-metatrader-5-download-free/",
        date: "2026-01-08"
    },
    {
        name: "BPR SFP Indicator ICT MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/bpr-sfp-indicator-ict-in-metatrader-5-free/",
        date: "2026-01-08"
    },
    {
        name: "Perfect Trendline Indicator MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/perfect-trendline-indicator-for-mt5/",
        date: "2026-01-08"
    },
    {
        name: "FVG Instantaneous Mitigation Signals MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/fvg-instantaneous-mitigation-signals-indicator-mt5/",
        date: "2026-01-08"
    },
    {
        name: "CCI Histogram Indicator MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/cci-histogram-indicator-for-metatrader-5-download/",
        date: "2026-01-08"
    },
    {
        name: "Channel Zig Zag Indicator MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/channel-zig-zag-indicator-for-mt5-download-free/",
        date: "2026-01-08"
    },
    {
        name: "Risk Reward Ratio Calculator MT5",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/risk-reward-ratio-calculator-indicator-for-mt5-free/",
        date: "2026-01-08"
    },
    {
        name: "ICT Entry V1 TradingView",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/ict-entry-v1-tradingview-free-download/",
        date: "2026-01-08"
    },
    {
        name: "Deeptest TradingView Indicator",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/deeptest-tradinview-indicator-free-download/",
        date: "2026-01-08"
    },
    {
        name: "Alien Matrix EA MT4",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/alien-mattrix-ea-mt4/",
        date: "2026-01-08"
    },
    {
        name: "LuxAlgo Price Action Concepts Lifetime",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/luxalgo-price-action-concepts-lifetime/",
        date: "2026-01-08"
    },
    {
        name: "Gains Algo Alpha V2 TradingView",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/gains-algo-alpha-v2-download-free-tradingview-pinescript/",
        date: "2026-01-08"
    },
    {
        name: "Arbitrage Detector LuxAlgo",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/arbitrage-detector-luxalgo-download-free/",
        date: "2026-01-08"
    },
    {
        name: "Million Moves Algo V4.3",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/million-moves-algo-v4-3/",
        date: "2026-01-08"
    },
    {
        name: "Infinity Algo Remake",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/infinity_algo_-_remake/",
        date: "2026-01-08"
    },
    {
        name: "Hyper Spectral Neural Flow TradingView",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/hyper-spectral-neural-flow-foe-tradingview-pinescript-free-download/",
        date: "2026-01-08"
    },
    {
        name: "Volume Weighted Price Z-Score QuantAlgo",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/volume-weighted-price-z-score-quantalgo/",
        date: "2026-01-08"
    },
    {
        name: "Delta Reaction Zones BosWaves",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/delta-reaction-zones-boswaves/",
        date: "2026-01-08"
    },
    {
        name: "Algo Samurai EA Full",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/algo-samurai-ea-full/",
        date: "2026-01-08"
    },
    {
        name: "Zone to Zone Indicator MT4 Source Code",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/zone-to-zone-indicator-for-metatrader4-source-code/",
        date: "2026-01-08"
    },
    {
        name: "FXSSI OrderBook Pro",
        category: ["metatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/fxssi-orderbook-pro/",
        date: "2026-01-08"
    },
    {
        name: "Combined Advanced Trading Blueprint TradingView",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/indicator-combined-advanced-trading-blueprint-for-tradingview/",
        date: "2026-01-08"
    },
    {
        name: "Expert Trade Assistant MT4 V10.23",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/expert-trade-assistant-mt4-v10-23/",
        date: "2026-01-08"
    },
    {
        name: "Quantum Queen MT5 V2.6",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/expert-quantum-queen-mt5-v2-6-dll-5430/",
        date: "2026-01-08"
    },
    {
        name: "Fish n Grid EA",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/fish-n-grid/",
        date: "2026-01-08"
    },
    {
        name: "Goldbot One MT4 V1.6",
        category: ["metatrader", "ea"],
        url: "https://infinityalgoacademy.net/item/expert-goldbot-one-mt4-v1-6-set/",
        date: "2026-01-08"
    },
    {
        name: "HSN Algo V9.5 TradingView",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/buy-sell-mr-mt4-hsn-algo-v9-5-tradingview/",
        date: "2026-01-08"
    },
    {
        name: "SMT Double Div TradingFinder NinjaTrader",
        category: ["ninjatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/smt-double-div-tradingfinder-indicator-in-ninjatrader-free/",
        date: "2026-01-07"
    },
    {
        name: "Fast Scalping AI NinjaTrader 8",
        category: ["ninjatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/fast-scalping-ai-ninjatrader-8-indicator-free/",
        date: "2026-01-04"
    },
    {
        name: "Footprint OrderFlow Indicator NinjaTrader",
        category: ["ninjatrader", "indicator"],
        url: "https://infinityalgoacademy.net/item/footprint-orderflow-indicator-in-ninjatrader/",
        date: "2026-01-04"
    },
    {
        name: "InfinityRSI Divergence V6.2",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/infinityrsi-divergence-v-6-2/",
        date: "2025-12-29"
    },
    {
        name: "RSI Monitor High/Low MTF Time Filter",
        category: ["tradingview", "indicator"],
        url: "https://infinityalgoacademy.net/item/rsi-monitor-high-low-mtf-time-filter/",
        date: "2025-12-29"
    }
];

// State management
let currentFilter = 'all';
let currentSort = 'newest';
let searchQuery = '';

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    updateCounts();
    renderProducts();
    setupEventListeners();
});

// Update category counts
function updateCounts() {
    document.getElementById('countAll').textContent = products.length;
    document.getElementById('countNinja').textContent = products.filter(p => p.category.includes('ninjatrader')).length;
    document.getElementById('countMT').textContent = products.filter(p => p.category.includes('metatrader')).length;
    document.getElementById('countTV').textContent = products.filter(p => p.category.includes('tradingview')).length;
    document.getElementById('countEA').textContent = products.filter(p => p.category.includes('ea')).length;
    document.getElementById('countInd').textContent = products.filter(p => p.category.includes('indicator')).length;
    document.getElementById('countCourse').textContent = products.filter(p => p.category.includes('course')).length;
}

// Setup event listeners
function setupEventListeners() {
    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.category;
            renderProducts();
        });
    });

    // Search input
    document.getElementById('searchInput').addEventListener('input', (e) => {
        searchQuery = e.target.value.toLowerCase();
        renderProducts();
    });

    // Sort dropdown
    document.getElementById('sortSelect').addEventListener('change', (e) => {
        currentSort = e.target.value;
        renderProducts();
    });
}

// Filter and sort products
function getFilteredProducts() {
    let filtered = products;

    // Apply category filter
    if (currentFilter !== 'all') {
        filtered = filtered.filter(p => p.category.includes(currentFilter));
    }

    // Apply search filter
    if (searchQuery) {
        filtered = filtered.filter(p => p.name.toLowerCase().includes(searchQuery));
    }

    // Apply sorting
    filtered = [...filtered].sort((a, b) => {
        switch (currentSort) {
            case 'newest':
                return new Date(b.date) - new Date(a.date);
            case 'oldest':
                return new Date(a.date) - new Date(b.date);
            case 'name-asc':
                return a.name.localeCompare(b.name);
            case 'name-desc':
                return b.name.localeCompare(a.name);
            default:
                return 0;
        }
    });

    return filtered;
}

// Render products
function renderProducts() {
    const grid = document.getElementById('productsGrid');
    const noResults = document.getElementById('noResults');
    const filtered = getFilteredProducts();

    if (filtered.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'flex';
        return;
    }

    grid.style.display = 'grid';
    noResults.style.display = 'none';

    grid.innerHTML = filtered.map(product => `
        <div class="product-card ${product.featured ? 'featured' : ''}">
            ${product.featured ? '<div class="featured-badge">Featured</div>' : ''}
            <div class="product-icon">
                ${getProductIcon(product.category)}
            </div>
            <h3 class="product-title">${product.name}</h3>
            <div class="product-tags">
                ${product.category.map(cat => `<span class="tag tag-${cat}">${formatCategory(cat)}</span>`).join('')}
            </div>
            <a href="${product.url}" target="_blank" class="product-btn">
                <span>View Product</span>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M3.33334 8H12.6667M12.6667 8L8.00001 3.33333M12.6667 8L8.00001 12.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
        </div>
    `).join('');
}

// Get product icon based on category
function getProductIcon(categories) {
    if (categories.includes('ninjatrader')) {
        return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path d="M16 4L6 9V14C6 20.6 10.4 26.8 16 28C21.6 26.8 26 20.6 26 14V9L16 4Z" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <defs><linearGradient id="grad1" x1="6" y1="4" x2="26" y2="28"><stop stop-color="#6366F1"/><stop offset="1" stop-color="#8B5CF6"/></linearGradient></defs>
        </svg>`;
    } else if (categories.includes('metatrader')) {
        return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <path d="M4 16L12 8L18 14L28 4" stroke="url(#grad2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <defs><linearGradient id="grad2" x1="4" y1="4" x2="28" y2="28"><stop stop-color="#10B981"/><stop offset="1" stop-color="#059669"/></linearGradient></defs>
        </svg>`;
    } else if (categories.includes('tradingview')) {
        return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <circle cx="16" cy="16" r="12" stroke="url(#grad3)" stroke-width="2"/>
            <defs><linearGradient id="grad3" x1="4" y1="4" x2="28" y2="28"><stop stop-color="#06B6D4"/><stop offset="1" stop-color="#3B82F6"/></linearGradient></defs>
        </svg>`;
    } else if (categories.includes('course')) {
        return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <rect x="6" y="8" width="20" height="16" rx="2" stroke="url(#grad4)" stroke-width="2"/>
            <defs><linearGradient id="grad4" x1="6" y1="8" x2="26" y2="24"><stop stop-color="#F59E0B"/><stop offset="1" stop-color="#EF4444"/></linearGradient></defs>
        </svg>`;
    }
    return `<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
        <path d="M16 28C22.6274 28 28 22.6274 28 16C28 9.37258 22.6274 4 16 4C9.37258 4 4 9.37258 4 16C4 22.6274 9.37258 28 16 28Z" stroke="url(#grad5)" stroke-width="2"/>
        <defs><linearGradient id="grad5" x1="4" y1="4" x2="28" y2="28"><stop stop-color="#EC4899"/><stop offset="1" stop-color="#8B5CF6"/></linearGradient></defs>
    </svg>`;
}

// Format category name
function formatCategory(cat) {
    const names = {
        'ninjatrader': 'NinjaTrader',
        'metatrader': 'MetaTrader',
        'tradingview': 'TradingView',
        'ea': 'Expert Advisor',
        'indicator': 'Indicator',
        'course': 'Course'
    };
    return names[cat] || cat;
}

// Hide loading spinner after page load
window.addEventListener('load', () => {
    document.getElementById('loadingSpinner').style.display = 'none';
});
